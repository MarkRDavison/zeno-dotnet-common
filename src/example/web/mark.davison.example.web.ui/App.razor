@using mark.davison.common.client.abstractions.Store
@using mark.davison.example.web.features.Store.StartupUseCase

@inject IStoreHelper _storeHelper

<Router AppAssembly="@typeof(App).Assembly" 
        AdditionalAssemblies="new[]{ typeof(Routes).Assembly }" 
        NotFoundPage="typeof(NotFound)">
    <Found Context="routeData">
            <AuthorizeRouteView RouteData="@routeData" DefaultLayout="@typeof(MainLayout)">
                <NotAuthorized>
                    @if (!context.User.Identity?.IsAuthenticated ?? true)
                    {
                        <Redirect Url="@Routes.Login" />
                    }
                    else
                    {
                        <p>You do not have permission to view this page.</p>
                        <a href="@Routes.Root">Return to home</a>
                    }
                </NotAuthorized>
                <Authorizing>
                    <div class="p-4">Checking authorization...</div>
                </Authorizing>
            </AuthorizeRouteView>
        <FocusOnNavigate RouteData="@routeData" Selector="h1" />
    </Found>
</Router>

@code
{
    protected override void OnInitialized()
    {
        _storeHelper.Dispatch(new FetchStartupAction());
    }
}